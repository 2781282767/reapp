#!/usr/bin/env node

var Program = require('commander');
var colors = require('colors');
var pack = require('reapp-pack');
var webpack = require('reapp-pack/webpack');
var webpackCallback = require('reapp-pack/lib/callback');
var makeBuildDir = require('./lib/makeBuildDir');
var checkIsReapp = require('./lib/checkIsReapp');

Program
  .option('-d, --debug', 'output extra information for debugging')
  .parse(process.argv);

var dir = process.cwd();

if (Program.debug) {
  console.log('CLI received opts:'.blue);
  console.log(Program);
  console.log();
}

checkIsReapp(dir);

// generate config
var buildConfig = require('reapp-pack/config/build.js');
var config = buildConfig({
  dir: dir,
  linkModules: true,
  debug: Program.debug
});

makeBuildDir(dir, run);

function run() {
  console.log('Building...'.yellow, "\n");
  webpack(config, webpackCallback({
    debug: Program.debug
  }));
}